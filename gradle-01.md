# Gadle (1) - 시작하기 

## 설치하기 

[그래들 공식사이트](https://gradle.org/install/)를 참고한다. 

* 자바가 설치되어 있어야 한다.
* 그래들의 현재(2021.12.29) 버전은 7.3.3이다. 


**다운로드**
[릴리스](https://gradle.org/releases/) 사이트로 가서 최신버전 7.3.3을 다운로드 받는다. binary-only를 받는다. 


* 적당한 경로에 압축을 푼다. 

**환경변수 설정** 
* Advanced System Settings \> Environment Variables를 선택한다. 
* System Variables에서 Path를 선택한다. 
* 설치한 Gradle의 bin 디렉터리를 추가한다. 

Window command 창에서 다음을 실행해서 설치를 확인한다. 
```shell
PS D:\> gradle -v

------------------------------------------------------------
Gradle 7.3.3
------------------------------------------------------------
```

## Java 프로젝트 만들기 

### 프로젝트 폴더 생성

```shell
$ mkdir demo
$ cd demo
```

### init task 실행
```shell
$ gradle init

Select type of project to generate:
  1: basic
  2: application  <-- 선택
  3: library
  4: Gradle plugin
Enter selection (default: basic) [1..4] 2

Select implementation language:
  1: C++
  2: Groovy
  3: Java <-- 선택
  4: Kotlin
  5: Scala
  6: Swift
Enter selection (default: Java) [1..6] 3

Split functionality across multiple subprojects?:
  1: no - only one application project <-- 선택
  2: yes - application and library projects


Select build script DSL:
  1: Groovy <-- 선택 
  2: Kotlin
Enter selection (default: Groovy) [1..2] 1

Generate build using new APIs and behavior (some features may change in the next minor release)? (default: no) [yes, no]

<-- no 선택

Select test framework:
  1: JUnit 4
  2: TestNG
  3: Spock
  4: JUnit Jupiter <-- 선택 
Enter selection (default: JUnit 4) [1..4]

Project name (default: demo):  <-- 엔터
Source package (default: demo): <-- 엔터


BUILD SUCCESSFUL
2 actionable tasks: 2 executed
```
init task는 다음의 구조를 생성할 것이다.
```shell
├── gradle ①
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew ②
├── gradlew.bat  ②
├── settings.gradle ③
└── app
    ├── build.gradle  ④
    └── src
        ├── main
        │   └── java ⑤
        │       └── demo
        │           └── App.java
        └── test
            └── java ⑥
                └── demo
                    └── AppTest.java
```


① wrapper files 들을 위해 생성된 폴더 
② Gradle wrapper start scripts 
③ build name과 subprojects를 정의하기 위한 설정 파일
④ app project의 Build Script. gradle의 기본 빌드 파일이다. 프로젝트 빌드를 정의.
⑤ Default Java source folder
⑥ Default Java test source folder 



**추가 설명**
* 빌드를 하고 나면 .gradle 라는 폴더가 생성이 되는데,  Gradle이 사용하는 폴더이다. task로 생성된 또는 변경된 내용을 저장한다. 
* gradle/wrapper/gradle-wrapper.jar는 Gradle wrapper 파일. gradlew 명령어로 프로젝트를 빌드할 때 이 파일을 참조하여 설정파일을 구성하므로 gradle build와 다르게 새로운 환경에 대한 영향이 없다.
* gradle/wrapper/gradle-wrapper.properties 는 Gradle Wrapper 설정파일이다. 
* gradlew는 gradle 명령어 파일.  gradlew는 unix용 파일이고 gradlew.bat은 윈도우용 파일.
* settings.gradle는 프로젝트 설정 정보 파일이다. 멀티 프로젝트를 구성할 때 하위 프로젝트들과의 관계를 여기서  정의해야 한다. 명시된 정보를 기준으로 프로젝트를 구성한다.








### 프로젝트 파일 살펴보기 

**settings.gradle** 
```properties
rootProject.name = 'demo'
include('app')
```

* rootProject.name는 빌드에 이름을 할당한다.  고정이름을 사용한다. 
* include("app")하나의 하위 프로젝트로 구성되는 것을 정의한다. include(...) 명령문으로 더 많은 하위 프로젝트를 추가할 수 있다. 


**app/build.gradle**
app이라는 하나의 subproject가 빌드에 포함되어 있다. 
```shell
/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.3.3/userguide/building_java_projects.html
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'  ①
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()  ②
}

dependencies {
    // Use JUnit Jupiter for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.2'  ③

    // This dependency is used by the application.
    implementation 'com.google.guava:guava:30.1.1-jre' ④
}

application {
    // Define the main class for the application.
    mainClass = 'demo.App'  ⑤
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform() ⑥
}
```
① Java에서 CLI application 빌드를 지원하기 위한 application plugin을 적용 
② dependencies를 해결을 위한 Maven Central을 사용 
③ Test를 위한  JUnit Jupiter 
④ 이 의존성은 application이 사용한다. 
⑤ application의 main class



### applicaiton 실행 
Command line에서 직접 app을 실행할 수 있다. 
```shell
PS D:\temp\demo> ./gradlew run

> Task :app:run
Hello World!

BUILD SUCCESSFUL in 5s
2 actionable tasks: 2 executed
```

### application 번들하기 

application plugin은 application을 번들한다. Gradle을 사용하려면 기본적으로 로컬 환경에 설치가 되어 있어야 한다. 특히 기존 자바 프로젝트를 빌드할 때는 자바 버전을 맞추어야 하는 경우가 있지만 GradleWrapper를 사용하면 Gradle 설치나 Java 버전에 관계없이 프로젝트를 빌드할 수 있다. 


```shell
PS D:\temp\demo> ./gradlew build

BUILD SUCCESSFUL in 4s
7 actionable tasks: 6 executed, 1 up-to-date
PS D:\temp\demo>
```
빌드하면 두개의 포맷으로 archive를 생성한다. 
```
app/build/distributions/app.tar
app/build/distributions/app.jar
```

### Build Scan을 퍼블리시하기 
빌드 뒤에서 어떤 일이 일어나는지 알기 위한 가장 좋은 방법은 build scan을 퍼블리시하는 것이다. --scan 옵션을 사용한다.
```shell
PS D:\temp\demo> ./gradlew build --scan


BUILD SUCCESSFUL in 6s
7 actionable tasks: 7 up-to-date

Publishing a build scan to scans.gradle.com requires accepting the Gradle Terms of Service defined at https://gradle.com/terms-of-service. Do you accept these terms? [yes, no] Please enter 'yes' or 'no': yes

Gradle Terms of Service accepted.

Publishing build scan...
https://gradle.com/s/su7nzkikttzty

PS D:\temp\demo>
```


















 
















